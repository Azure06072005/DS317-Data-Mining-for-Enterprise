{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/trakiet/dualeo?scriptVersionId=274466077\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"code","execution_count":1,"id":"7d01bd6f","metadata":{"_cell_guid":"b1076dfc-b9ad-4769-8c92-a6c4dae69d19","_uuid":"8f2839f25d086af736a60e9eeb907d3b93b6e0e5","execution":{"iopub.execute_input":"2025-11-08T09:03:57.324677Z","iopub.status.busy":"2025-11-08T09:03:57.324396Z","iopub.status.idle":"2025-11-08T09:03:58.995784Z","shell.execute_reply":"2025-11-08T09:03:58.995022Z"},"papermill":{"duration":1.681885,"end_time":"2025-11-08T09:03:58.997685","exception":false,"start_time":"2025-11-08T09:03:57.3158","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00064-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00010-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00088-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00165-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00178-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00149-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00190-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00153-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00180-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00091-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00191-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00120-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00046-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00141-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00054-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00108-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00016-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00101-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00145-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00040-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00110-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00020-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00003-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00066-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00134-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00006-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00199-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00061-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00151-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00130-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00026-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00024-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00033-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00019-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00164-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00116-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00123-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00182-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00169-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00189-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00111-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00152-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00171-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00080-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00096-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00109-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00125-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00098-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00135-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00139-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00044-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00119-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00177-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00181-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00148-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00115-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00079-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00168-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00155-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00193-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00114-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00053-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00077-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00027-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00104-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00034-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00198-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00124-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00131-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00126-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00039-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00063-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00002-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00147-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00103-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00076-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00157-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00081-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00107-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00042-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00173-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00047-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00021-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00090-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00014-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00060-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00015-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00162-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00073-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00187-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00158-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00144-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00118-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00137-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00099-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00195-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00117-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00032-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00138-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00094-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00051-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00065-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00023-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00097-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00025-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00089-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00062-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00121-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00113-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00128-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00167-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00005-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00133-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00170-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00045-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00084-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00102-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00004-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00001-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00007-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00174-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00067-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00093-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00069-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00011-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00049-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00179-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00150-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00197-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00129-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00078-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00068-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00146-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00176-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00058-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00018-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00194-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00106-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00188-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00143-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00127-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00142-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00071-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00132-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00070-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00028-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00056-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00000-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00037-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00029-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00184-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00086-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00186-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00154-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00048-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00059-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00022-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00100-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00192-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00196-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00175-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00136-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00156-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00095-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00092-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00160-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00112-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00041-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00085-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00055-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00050-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00140-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00183-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00031-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00172-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00163-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00122-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00057-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00012-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00043-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00075-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00159-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00008-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00013-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00083-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00166-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00009-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00036-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00017-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00038-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00030-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00035-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00185-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00161-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/_SUCCESS\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00072-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00082-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00105-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00087-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00074-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_with_stats_fixed.parquet/part-00052-4e5200ed-6360-4cc9-a1c4-2899d2e588e6-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_user_video_final.parquet/part-00004-be584545-8204-4005-9a41-89ee3dea23bc-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_user_video_final.parquet/part-00002-be584545-8204-4005-9a41-89ee3dea23bc-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_user_video_final.parquet/part-00007-be584545-8204-4005-9a41-89ee3dea23bc-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_user_video_final.parquet/part-00003-be584545-8204-4005-9a41-89ee3dea23bc-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_user_video_final.parquet/part-00006-be584545-8204-4005-9a41-89ee3dea23bc-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_user_video_final.parquet/part-00000-be584545-8204-4005-9a41-89ee3dea23bc-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_user_video_final.parquet/part-00005-be584545-8204-4005-9a41-89ee3dea23bc-c000.snappy.parquet\n","/kaggle/input/user-video-final/df_user_video_final.parquet/_SUCCESS\n","/kaggle/input/user-video-final/df_user_video_final.parquet/part-00001-be584545-8204-4005-9a41-89ee3dea23bc-c000.snappy.parquet\n","/kaggle/input/user-course-group/part-00003-7b731a72-3ce3-43af-8433-f0f3d3d0ee05-c000.snappy.parquet\n","/kaggle/input/user-course-group/.part-00001-7b731a72-3ce3-43af-8433-f0f3d3d0ee05-c000.snappy.parquet.crc\n","/kaggle/input/user-course-group/part-00000-7b731a72-3ce3-43af-8433-f0f3d3d0ee05-c000.snappy.parquet\n","/kaggle/input/user-course-group/.part-00003-7b731a72-3ce3-43af-8433-f0f3d3d0ee05-c000.snappy.parquet.crc\n","/kaggle/input/user-course-group/part-00001-7b731a72-3ce3-43af-8433-f0f3d3d0ee05-c000.snappy.parquet\n","/kaggle/input/user-course-group/._SUCCESS.crc\n","/kaggle/input/user-course-group/.part-00000-7b731a72-3ce3-43af-8433-f0f3d3d0ee05-c000.snappy.parquet.crc\n","/kaggle/input/user-course-group/part-00002-7b731a72-3ce3-43af-8433-f0f3d3d0ee05-c000.snappy.parquet\n","/kaggle/input/user-course-group/.part-00002-7b731a72-3ce3-43af-8433-f0f3d3d0ee05-c000.snappy.parquet.crc\n","/kaggle/input/user-course-group/_SUCCESS\n"]}],"source":["# This Python 3 environment comes with many helpful analytics libraries installed\n","# It is defined by the kaggle/python Docker image: https://github.com/kaggle/docker-python\n","# For example, here's several helpful packages to load\n","\n","import numpy as np # linear algebra\n","import pandas as pd # data processing, CSV file I/O (e.g. pd.read_csv)\n","\n","# Input data files are available in the read-only \"../input/\" directory\n","# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n","\n","import os\n","for dirname, _, filenames in os.walk('/kaggle/input'):\n","    for filename in filenames:\n","        print(os.path.join(dirname, filename))\n","\n","# You can write up to 20GB to the current directory (/kaggle/working/) that gets preserved as output when you create a version using \"Save & Run All\" \n","# You can also write temporary files to /kaggle/temp/, but they won't be saved outside of the current session"]},{"cell_type":"code","execution_count":2,"id":"b34f7e9d","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:03:59.013526Z","iopub.status.busy":"2025-11-08T09:03:59.012803Z","iopub.status.idle":"2025-11-08T09:03:59.016213Z","shell.execute_reply":"2025-11-08T09:03:59.015673Z"},"papermill":{"duration":0.011819,"end_time":"2025-11-08T09:03:59.017312","exception":false,"start_time":"2025-11-08T09:03:59.005493","status":"completed"},"tags":[]},"outputs":[],"source":["df_user_video_final_path = '/kaggle/input/user-video-final/df_user_video_final.parquet'\n","df_user_course_grouped_path = '/kaggle/input/user-course-group'"]},{"cell_type":"code","execution_count":3,"id":"ce20dee7","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:03:59.031446Z","iopub.status.busy":"2025-11-08T09:03:59.030924Z","iopub.status.idle":"2025-11-08T09:04:07.709443Z","shell.execute_reply":"2025-11-08T09:04:07.708453Z"},"papermill":{"duration":8.68751,"end_time":"2025-11-08T09:04:07.711296","exception":false,"start_time":"2025-11-08T09:03:59.023786","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["Setting default log level to \"WARN\".\n","To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).\n","25/11/08 09:04:05 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\n"]}],"source":["import pyspark\n","from pyspark.sql import SparkSession\n","import warnings\n","from pyspark.sql.types import *\n","from pyspark.sql import functions as F\n","from pyspark.sql.types import IntegerType\n","import seaborn as sns\n","import matplotlib.pyplot as plt\n","from os import truncate\n","from pyspark.sql.functions import explode, col, sum, from_unixtime, hour, dayofweek, count, round, when, isnull, split, avg, regexp_replace\n","warnings.filterwarnings(\"ignore\")\n","\n","spark = SparkSession.builder \\\n","  .appName(\"reply_user_video_analysis\") \\\n","  .master(\"local[*]\") \\\n","  .config(\"spark.some.config.option\", \"some-value\") \\\n","  .getOrCreate()"]},{"cell_type":"code","execution_count":4,"id":"0b7100b9","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:07.7271Z","iopub.status.busy":"2025-11-08T09:04:07.726579Z","iopub.status.idle":"2025-11-08T09:04:12.228139Z","shell.execute_reply":"2025-11-08T09:04:12.227576Z"},"papermill":{"duration":4.510865,"end_time":"2025-11-08T09:04:12.229706","exception":false,"start_time":"2025-11-08T09:04:07.718841","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["                                                                                \r"]}],"source":["# ƒê·ªçc to√†n b·ªô folder (t·ª± ƒë·ªông load t·∫•t c·∫£ part-*.parquet)\n","df_user_video_final = spark.read.parquet(df_user_video_final_path)\n","df_user_course_grouped = spark.read.parquet(df_user_course_grouped_path)"]},{"cell_type":"code","execution_count":5,"id":"b5e98932","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:12.245101Z","iopub.status.busy":"2025-11-08T09:04:12.24479Z","iopub.status.idle":"2025-11-08T09:04:14.349872Z","shell.execute_reply":"2025-11-08T09:04:14.349001Z"},"papermill":{"duration":2.114509,"end_time":"2025-11-08T09:04:14.351276","exception":false,"start_time":"2025-11-08T09:04:12.236767","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["3405404"]},"execution_count":5,"metadata":{},"output_type":"execute_result"}],"source":["df_user_course_grouped.count()"]},{"cell_type":"code","execution_count":6,"id":"ada7b298","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:14.374871Z","iopub.status.busy":"2025-11-08T09:04:14.374603Z","iopub.status.idle":"2025-11-08T09:04:17.006446Z","shell.execute_reply":"2025-11-08T09:04:17.004994Z"},"papermill":{"duration":2.646966,"end_time":"2025-11-08T09:04:17.008165","exception":false,"start_time":"2025-11-08T09:04:14.361199","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["                                                                                \r"]},{"name":"stdout","output_type":"stream","text":["+---------+----------+-----------+----------+----------+----------+--------------------+--------------------+----------+\n","|course_id|   user_id|enroll_date|start_date|  end_date|remain_day|          video_list|total_video_duration|num_videos|\n","+---------+----------+-----------+----------+----------+----------+--------------------+--------------------+----------+\n","| C_676937|U_15287250| 2020-05-07|2020-02-12|2020-07-31|        85|[V_69198, V_69199...|            29257.56|        84|\n","| C_883345|U_15287757| 2020-02-11|2020-01-20|2020-07-31|       171|[V_1007135, V_100...|  254558.64200000005|      1006|\n","| C_883345|U_15287761| 2020-02-19|2020-01-20|2020-07-31|       163|[V_1007135, V_100...|  254558.64200000005|      1006|\n","| C_883345|U_15287911| 2020-01-21|2020-01-20|2020-07-31|       192|[V_1007135, V_100...|  254558.64200000005|      1006|\n","| C_948409|U_15288689| 2020-02-03|2019-08-01|2020-03-31|        57|[V_1483636, V_148...|  12534.189999999999|        55|\n","| C_883345|U_15288813| 2020-04-11|2020-01-20|2020-07-31|       111|[V_1007135, V_100...|  254558.64200000005|      1006|\n","| C_676937|U_15288979| 2020-03-13|2020-02-12|2020-07-31|       140|[V_69198, V_69199...|            29257.56|        84|\n","| C_676937|U_15289040| 2020-04-02|2020-02-12|2020-07-31|       120|[V_69198, V_69199...|            29257.56|        84|\n","| C_883345|U_15289040| 2020-10-12|2020-08-24|2020-12-31|        80|[V_1007135, V_100...|  254558.64200000005|      1006|\n","| C_883345|U_15289085| 2020-02-10|2020-01-20|2020-07-31|       172|[V_1007135, V_100...|  254558.64200000005|      1006|\n","| C_883345|U_15289090| 2020-04-17|2020-01-20|2020-07-31|       105|[V_1007135, V_100...|  254558.64200000005|      1006|\n","| C_883345|U_15289226| 2020-01-31|2020-01-20|2020-07-31|       182|[V_1007135, V_100...|  254558.64200000005|      1006|\n","| C_948409|U_15289798| 2020-04-29|2020-04-03|2020-07-30|        92|[V_1483636, V_148...|  12534.189999999999|        55|\n","| C_883345|U_15290896| 2020-05-08|2020-01-20|2020-07-31|        84|[V_1007135, V_100...|  254558.64200000005|      1006|\n","| C_676937|U_15291850| 2020-03-16|2020-02-12|2020-07-31|       137|[V_69198, V_69199...|            29257.56|        84|\n","| C_883345|U_15291850| 2020-04-17|2020-01-20|2020-07-31|       105|[V_1007135, V_100...|  254558.64200000005|      1006|\n","| C_948409|U_15291986| 2020-05-31|2020-04-03|2020-07-30|        60|[V_1483636, V_148...|  12534.189999999999|        55|\n","| C_948409|U_15292006| 2020-06-02|2020-04-03|2020-07-30|        58|[V_1483636, V_148...|  12534.189999999999|        55|\n","| C_948409|U_15292020| 2020-05-31|2020-04-03|2020-07-30|        60|[V_1483636, V_148...|  12534.189999999999|        55|\n","| C_948409|U_15292104| 2020-05-31|2020-04-03|2020-07-30|        60|[V_1483636, V_148...|  12534.189999999999|        55|\n","+---------+----------+-----------+----------+----------+----------+--------------------+--------------------+----------+\n","only showing top 20 rows\n","\n"]}],"source":["df_user_course_grouped.show()"]},{"cell_type":"code","execution_count":7,"id":"c666ff55","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:17.036094Z","iopub.status.busy":"2025-11-08T09:04:17.035349Z","iopub.status.idle":"2025-11-08T09:04:17.350036Z","shell.execute_reply":"2025-11-08T09:04:17.349187Z"},"papermill":{"duration":0.330107,"end_time":"2025-11-08T09:04:17.351412","exception":false,"start_time":"2025-11-08T09:04:17.021305","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["1977141"]},"execution_count":7,"metadata":{},"output_type":"execute_result"}],"source":["df_user_video_final.count()"]},{"cell_type":"code","execution_count":8,"id":"a61196e8","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:17.368221Z","iopub.status.busy":"2025-11-08T09:04:17.367573Z","iopub.status.idle":"2025-11-08T09:04:17.812796Z","shell.execute_reply":"2025-11-08T09:04:17.812076Z"},"papermill":{"duration":0.455332,"end_time":"2025-11-08T09:04:17.814275","exception":false,"start_time":"2025-11-08T09:04:17.358943","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["+----------+---------+---------------+------------------+------------------+----------------------+-----------------+-------------------+-----------------+-------------+------------------+---------------------+----------+---------------+-------------+\n","|   user_id| video_id|max_watch_point|       rewind_time| fast_forward_time|first_local_start_time|actual_watch_time|weighted_watch_time|interaction_count|session_count|speed_change_count|distinct_speeds_count|start_hour|start_dayofweek|average_speed|\n","+----------+---------+---------------+------------------+------------------+----------------------+-----------------+-------------------+-----------------+-------------+------------------+---------------------+----------+---------------+-------------+\n","|U_10001587|V_6012902|         1097.4|               0.0|             140.0|   2020-08-19 10:34:56|            950.5|             475.25|                2|            1|                 0|                    1|        10|              4|          2.0|\n","| U_1000290|V_6280776|         1042.3|               0.0|              94.9|   2020-10-03 01:23:10|            942.5|              942.5|                4|            1|                 0|                    1|         1|              7|          1.0|\n","|U_10008027|V_6059415|          706.9|               0.0|               0.0|   2020-08-19 13:08:52|            702.0|              702.0|                1|            1|                 0|                    1|        13|              4|          1.0|\n","|U_10011100|V_6043053|         2779.8|29.000000000000004|210.79999999999998|   2020-08-19 15:13:37|           2595.0|             2595.0|              519|            1|                 0|                    1|        15|              4|          1.0|\n","|U_10012383|V_6026303|         3401.7|               0.0|            3362.0|   2020-08-18 16:11:32|             35.0|               35.0|                2|            1|                 0|                    1|        16|              3|          1.0|\n","|U_10012383|V_6043053|         3128.0|            2585.5|            1139.0|   2020-08-18 01:16:05|           1950.0|             1950.0|               41|            1|                 0|                    1|         1|              3|          1.0|\n","|U_10012383|V_6043065|         9623.6|             180.7| 4678.200000000001|   2020-08-18 13:39:57|           5121.3|             5121.3|               23|            1|                 0|                    1|        13|              3|          1.0|\n","|U_10013620|V_7386537|         2399.9|               0.0|             279.6|   2020-09-24 02:44:48|           1250.5|             625.25|                4|            1|                 0|                    1|         2|              5|          2.0|\n","|U_10013633|V_7386534|          128.3|               0.0|               0.0|   2020-09-21 08:56:12|            120.0|               60.0|                1|            1|                 0|                    1|         8|              2|          2.0|\n","|U_10013633|V_7386535|         5328.7|               0.0|            2820.1|   2020-09-21 09:32:58|           2499.4|             1249.7|                5|            1|                 0|                    1|         9|              2|          2.0|\n","|U_10016535|V_7386537|          950.0|               0.0|              65.0|   2020-09-21 10:38:19|            880.1|              880.1|                3|            1|                 0|                    1|        10|              2|          1.0|\n","|U_10017195|V_7386535|         2054.9|               0.0|             125.0|   2020-09-21 10:21:09|           1925.0|             1925.0|                5|            1|                 0|                    1|        10|              2|          1.0|\n","|U_10018490|V_7386534|         3238.2|               0.0|             311.4|   2020-09-25 06:19:15|           2920.1|            1460.05|                7|            1|                 0|                    1|         6|              6|          2.0|\n","|U_10018910|V_7386537|         2746.5|               0.0|             129.5|   2020-09-22 08:57:25|            567.6|              283.8|                2|            1|                 0|                    1|         8|              3|          2.0|\n","| U_1001999|V_6354955|         1545.0|               0.0|            1451.0|   2020-10-23 01:27:06|             89.0|               89.0|                3|            1|                 0|                    1|         1|              6|          1.0|\n","|  U_100203|V_6328750|          198.0|               0.0|             116.0|   2020-09-22 13:23:07|             77.0|              51.33|                3|            1|                 0|                    1|        13|              3|          1.5|\n","| U_1002389|V_6202616|          423.0|               0.0|              12.0|   2020-09-23 16:07:55|            407.0|              407.0|                3|            1|                 0|                    1|        16|              4|          1.0|\n","|U_10024550|V_7386534|         2654.7|               0.0|             660.0|   2020-10-04 07:13:09|            895.0|              895.0|                8|            1|                 0|                    1|         7|              1|          1.0|\n","|U_10026106|V_7386534|          665.6|               0.0|             119.8|   2020-10-03 07:28:39|            540.0|              270.0|                2|            1|                 0|                    1|         7|              7|          2.0|\n","|U_10026204|V_7386532|         3216.2|               5.1|             100.0|   2020-09-29 16:14:53|            575.1|             545.05|                5|            1|                 1|                    2|        16|              3|         1.06|\n","+----------+---------+---------------+------------------+------------------+----------------------+-----------------+-------------------+-----------------+-------------+------------------+---------------------+----------+---------------+-------------+\n","only showing top 20 rows\n","\n"]}],"source":["df_user_video_final.show()"]},{"cell_type":"markdown","id":"2ddb5efe","metadata":{"papermill":{"duration":0.00721,"end_time":"2025-11-08T09:04:17.829168","exception":false,"start_time":"2025-11-08T09:04:17.821958","status":"completed"},"tags":[]},"source":["# Th·ªëng k√™ User-video"]},{"cell_type":"markdown","id":"7af779fb","metadata":{"papermill":{"duration":0.006811,"end_time":"2025-11-08T09:04:17.843143","exception":false,"start_time":"2025-11-08T09:04:17.836332","status":"completed"},"tags":[]},"source":["## üìä 1. Th·ªëng k√™ m√¥ t·∫£ t·ªïng qu√°t (Overall Descriptive Statistics)"]},{"cell_type":"code","execution_count":9,"id":"1573be19","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:17.859367Z","iopub.status.busy":"2025-11-08T09:04:17.859056Z","iopub.status.idle":"2025-11-08T09:04:17.86269Z","shell.execute_reply":"2025-11-08T09:04:17.862136Z"},"papermill":{"duration":0.013352,"end_time":"2025-11-08T09:04:17.863813","exception":false,"start_time":"2025-11-08T09:04:17.850461","status":"completed"},"tags":[]},"outputs":[],"source":["# # Ch·ªçn c√°c c·ªôt s·ªë ch√≠nh ƒë·ªÉ xem th·ªëng k√™\n","# numeric_cols = [\n","#     'max_watch_point', 'rewind_time', 'fast_forward_time', \n","#     'actual_watch_time', 'weighted_watch_time', 'interaction_count', \n","#     'session_count', 'average_speed'\n","# ]\n","\n","# # S·ª≠ d·ª•ng describe() v√† show()\n","# df_user_video_final.select(numeric_cols).describe().show()"]},{"cell_type":"markdown","id":"34102fa1","metadata":{"papermill":{"duration":0.007294,"end_time":"2025-11-08T09:04:17.878331","exception":false,"start_time":"2025-11-08T09:04:17.871037","status":"completed"},"tags":[]},"source":["## üìà 2. Ph√¢n t√≠ch theo nh√≥m (Grouped Statistics)"]},{"cell_type":"markdown","id":"840dddd9","metadata":{"papermill":{"duration":0.007421,"end_time":"2025-11-08T09:04:17.893185","exception":false,"start_time":"2025-11-08T09:04:17.885764","status":"completed"},"tags":[]},"source":["Ph√¢n t√≠ch h√†nh vi ng∆∞·ªùi d√πng (User-Level)"]},{"cell_type":"code","execution_count":10,"id":"b8a7d83d","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:17.908745Z","iopub.status.busy":"2025-11-08T09:04:17.908471Z","iopub.status.idle":"2025-11-08T09:04:17.911825Z","shell.execute_reply":"2025-11-08T09:04:17.911387Z"},"papermill":{"duration":0.012785,"end_time":"2025-11-08T09:04:17.912947","exception":false,"start_time":"2025-11-08T09:04:17.900162","status":"completed"},"tags":[]},"outputs":[],"source":["# from pyspark.sql import functions as F\n","\n","# # Th·ªëng k√™ t·ªïng quan tr√™n m·ªói ng∆∞·ªùi d√πng\n","# user_stats = df_user_video_final.groupBy('user_id').agg(\n","#     F.count('video_id').alias('total_videos_watched'),\n","#     F.sum('actual_watch_time').alias('total_watch_time_sec'),\n","#     F.avg('interaction_count').alias('avg_interactions_per_video'),\n","#     F.avg('average_speed').alias('avg_playback_speed')\n","# ).orderBy(F.col('total_watch_time_sec').desc())\n","\n","# # Hi·ªÉn th·ªã 10 ng∆∞·ªùi d√πng xem nhi·ªÅu nh·∫•t\n","# user_stats.show(10)"]},{"cell_type":"markdown","id":"43867db6","metadata":{"papermill":{"duration":0.007274,"end_time":"2025-11-08T09:04:17.927522","exception":false,"start_time":"2025-11-08T09:04:17.920248","status":"completed"},"tags":[]},"source":["Ph√¢n t√≠ch m·ª©c ƒë·ªô ph·ªï bi·∫øn c·ªßa Video (Video-Level) \n","M·ª•c ƒë√≠ch: Hi·ªÉu video n√†o thu h√∫t nh·∫•t, ƒë∆∞·ª£c xem nhi·ªÅu nh·∫•t, hay g√¢y t∆∞∆°ng t√°c nhi·ªÅu nh·∫•t."]},{"cell_type":"code","execution_count":11,"id":"f3628fa6","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:17.942666Z","iopub.status.busy":"2025-11-08T09:04:17.9424Z","iopub.status.idle":"2025-11-08T09:04:17.945836Z","shell.execute_reply":"2025-11-08T09:04:17.945281Z"},"papermill":{"duration":0.012259,"end_time":"2025-11-08T09:04:17.946876","exception":false,"start_time":"2025-11-08T09:04:17.934617","status":"completed"},"tags":[]},"outputs":[],"source":["# # Th·ªëng k√™ t·ªïng quan tr√™n m·ªói video\n","# video_stats = df_user_video_final.groupBy('video_id').agg(\n","#     F.count('user_id').alias('unique_viewers'),\n","#     F.sum('actual_watch_time').alias('total_watch_time_sec'),\n","#     F.avg('actual_watch_time').alias('avg_watch_time_per_user'),\n","#     F.avg('interaction_count').alias('avg_interactions'),\n","#     F.sum('rewind_time').alias('total_rewinds') # Video n√†o b·ªã tua l·∫°i nhi·ªÅu?\n","# ).orderBy(F.col('unique_viewers').desc())\n","\n","# # Hi·ªÉn th·ªã 10 video ƒë∆∞·ª£c xem nhi·ªÅu nh·∫•t\n","# video_stats.show(10)"]},{"cell_type":"markdown","id":"851bad6f","metadata":{"papermill":{"duration":0.006843,"end_time":"2025-11-08T09:04:17.960702","exception":false,"start_time":"2025-11-08T09:04:17.953859","status":"completed"},"tags":[]},"source":["## üïí 3. Ph√¢n t√≠ch theo th·ªùi gian (Temporal Analysis)"]},{"cell_type":"markdown","id":"72603ded","metadata":{"papermill":{"duration":0.006885,"end_time":"2025-11-08T09:04:17.974437","exception":false,"start_time":"2025-11-08T09:04:17.967552","status":"completed"},"tags":[]},"source":["M·ª•c ƒë√≠ch: T√¨m hi·ªÉu khi n√†o ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông t√≠ch c·ª±c nh·∫•t."]},{"cell_type":"code","execution_count":12,"id":"7bfe6a40","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:17.989356Z","iopub.status.busy":"2025-11-08T09:04:17.989036Z","iopub.status.idle":"2025-11-08T09:04:17.992768Z","shell.execute_reply":"2025-11-08T09:04:17.992026Z"},"papermill":{"duration":0.012848,"end_time":"2025-11-08T09:04:17.994015","exception":false,"start_time":"2025-11-08T09:04:17.981167","status":"completed"},"tags":[]},"outputs":[],"source":["# # 1. Gi·ªù cao ƒëi·ªÉm trong ng√†y\n","# hourly_activity = df_user_video_final.groupBy('start_hour') \\\n","#     .count() \\\n","#     .orderBy('start_hour')\n","\n","# hourly_activity.show(24)\n","\n","# # 2. Ng√†y cao ƒëi·ªÉm trong tu·∫ßn (Gi·∫£ s·ª≠ 1=Ch·ªß Nh·∫≠t, ..., 7=Th·ª© B·∫£y ho·∫∑c 1=Th·ª© Hai... t√πy F.dayofweek)\n","# day_activity = df_user_video_final.groupBy('start_dayofweek') \\\n","#     .count() \\\n","#     .orderBy('start_dayofweek')\n","\n","# day_activity.show()"]},{"cell_type":"markdown","id":"3e7f7799","metadata":{"papermill":{"duration":0.006662,"end_time":"2025-11-08T09:04:18.007514","exception":false,"start_time":"2025-11-08T09:04:18.000852","status":"completed"},"tags":[]},"source":["## üîó 4. Ph√¢n t√≠ch t∆∞∆°ng quan (Correlation Analysis)"]},{"cell_type":"markdown","id":"0b16ba6b","metadata":{"papermill":{"duration":0.006534,"end_time":"2025-11-08T09:04:18.020855","exception":false,"start_time":"2025-11-08T09:04:18.014321","status":"completed"},"tags":[]},"source":["M·ª•c ƒë√≠ch: Hi·ªÉu m·ªëi quan h·ªá gi·ªØa c√°c h√†nh vi. V√≠ d·ª•:\n","\n","actual_watch_time v√† interaction_count (Xem l√¢u c√≥ t∆∞∆°ng t√°c nhi·ªÅu kh√¥ng?)\n","\n","actual_watch_time v√† rewind_time (Xem l√¢u c√≥ ph·∫£i v√¨ tua l·∫°i nhi·ªÅu kh√¥ng?)\n","\n","average_speed v√† actual_watch_time (Ng∆∞·ªùi xem t·ªëc ƒë·ªô nhanh c√≥ xem h·∫øt video kh√¥ng?)"]},{"cell_type":"code","execution_count":13,"id":"fd96a924","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:18.036025Z","iopub.status.busy":"2025-11-08T09:04:18.03552Z","iopub.status.idle":"2025-11-08T09:04:18.039404Z","shell.execute_reply":"2025-11-08T09:04:18.038819Z"},"papermill":{"duration":0.012759,"end_time":"2025-11-08T09:04:18.040547","exception":false,"start_time":"2025-11-08T09:04:18.027788","status":"completed"},"tags":[]},"outputs":[],"source":["# from pyspark.ml.feature import VectorAssembler\n","# from pyspark.ml.stat import Correlation\n","# from pyspark.sql import functions as F\n","\n","# # 1. ƒê·ªãnh nghƒ©a c√°c c·ªôt b·∫°n mu·ªën t√≠nh t∆∞∆°ng quan\n","# corr_cols = [\n","#     'max_watch_point', 'rewind_time', 'fast_forward_time', \n","#     'actual_watch_time', 'interaction_count', 'average_speed'\n","# ]\n","\n","# # 2. (N√™n l√†m) Ki·ªÉm tra xem c·ªôt n√†o c√≥ gi√° tr·ªã nulltrong \n","# print(\"Ki·ªÉm tra gi√° tr·ªã null trong c√°c c·ªôt t∆∞∆°ng quan:\")\n","# df_user_video_final.select([F.count(F.when(F.col(c).isNull(), c)).alias(c) for c in corr_cols]).show()\n","\n","# # 3. T·∫°o m·ªôt DataFrame m·ªõi ƒê√É LO·∫†I B·ªé c√°c h√†ng c√≥ null trong C√ÅC C·ªòT N√ÄY\n","# # ƒê√¢y l√† b∆∞·ªõc s·ª≠a l·ªói quan tr·ªçng nh·∫•t\n","# df_corr_ready = df_user_video_final.na.drop(subset=corr_cols)\n","\n","# print(f\"S·ªë h√†ng ban ƒë·∫ßu: {df_user_video_final.count()}\")\n","# print(f\"S·ªë h√†ng sau khi lo·∫°i b·ªè null: {df_corr_ready.count()}\")\n","\n","# # 4. T·∫°o VectorAssembler\n","# # V√¨ ch√∫ng ta ƒë√£ t·ª± d·ªçn d·∫πp null, n√™n c√≥ th·ªÉ gi·ªØ c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh\n","# assembler = VectorAssembler(inputCols=corr_cols, outputCol=\"features\")\n","\n","# # 5. Transform DataFrame ƒë√£ ƒë∆∞·ª£c l√†m s·∫°ch\n","# df_corr_vector = assembler.transform(df_corr_ready).select(\"features\")\n","\n","# # 6. T√≠nh ma tr·∫≠n t∆∞∆°ng quan (Pearson)\n","# try:\n","#     corr_matrix_row = Correlation.corr(df_corr_vector, \"features\", \"pearson\").head()\n","    \n","#     print(\"\\n--- Ma tr·∫≠n t∆∞∆°ng quan (Pearson) ---\")\n","#     corr_matrix = corr_matrix_row[0].toArray()\n","#     print(f\"C·ªôt: {corr_cols}\")\n","#     print(corr_matrix)\n","\n","# except Exception as e:\n","#     print(f\"ƒê√£ x·∫£y ra l·ªói trong qu√° tr√¨nh t√≠nh t∆∞∆°ng quan: {e}\")"]},{"cell_type":"code","execution_count":14,"id":"1137435e","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:18.055889Z","iopub.status.busy":"2025-11-08T09:04:18.055144Z","iopub.status.idle":"2025-11-08T09:04:18.058862Z","shell.execute_reply":"2025-11-08T09:04:18.058154Z"},"papermill":{"duration":0.012444,"end_time":"2025-11-08T09:04:18.059968","exception":false,"start_time":"2025-11-08T09:04:18.047524","status":"completed"},"tags":[]},"outputs":[],"source":["# import matplotlib.pyplot as plt\n","# import seaborn as sns\n","# import pandas as pd\n","\n","# df = df_user_video_final.toPandas()\n","\n","# cols = ['max_watch_point','rewind_time','fast_forward_time',\n","#         'actual_watch_time','interaction_count','average_speed']\n","\n","# sns.pairplot(df[cols], diag_kind=\"kde\")\n","# plt.suptitle(\"Ph√¢n ph·ªëi v√† t∆∞∆°ng quan c√°c ch·ªâ s·ªë h√†nh vi xem video\", y=1.02)\n","# plt.show()\n"]},{"cell_type":"code","execution_count":15,"id":"0a2e6cca","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:18.074459Z","iopub.status.busy":"2025-11-08T09:04:18.074194Z","iopub.status.idle":"2025-11-08T09:04:18.077538Z","shell.execute_reply":"2025-11-08T09:04:18.076803Z"},"papermill":{"duration":0.011908,"end_time":"2025-11-08T09:04:18.078721","exception":false,"start_time":"2025-11-08T09:04:18.066813","status":"completed"},"tags":[]},"outputs":[],"source":["# top_users = user_stats.toPandas().head(10)\n","# sns.barplot(data=top_users, x='user_id', y='total_watch_time_sec')\n","# plt.xticks(rotation=45)\n","# plt.title(\"Top 10 ng∆∞·ªùi d√πng xem nhi·ªÅu nh·∫•t\")\n","# plt.show()\n"]},{"cell_type":"code","execution_count":16,"id":"dca8fbb2","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:18.093205Z","iopub.status.busy":"2025-11-08T09:04:18.092976Z","iopub.status.idle":"2025-11-08T09:04:18.096303Z","shell.execute_reply":"2025-11-08T09:04:18.095742Z"},"papermill":{"duration":0.011842,"end_time":"2025-11-08T09:04:18.09742","exception":false,"start_time":"2025-11-08T09:04:18.085578","status":"completed"},"tags":[]},"outputs":[],"source":["# hourly = df.groupby('start_hour')['user_id'].count().reset_index()\n","# day = df.groupby('start_dayofweek')['user_id'].count().reset_index()\n","\n","# fig, ax = plt.subplots(1,2, figsize=(12,5))\n","# sns.barplot(data=hourly, x='start_hour', y='user_id', ax=ax[0])\n","# sns.barplot(data=day, x='start_dayofweek', y='user_id', ax=ax[1])\n","# ax[0].set_title(\"Ph√¢n ph·ªëi l∆∞·ª£t xem theo gi·ªù trong ng√†y\")\n","# ax[1].set_title(\"Ph√¢n ph·ªëi l∆∞·ª£t xem theo ng√†y trong tu·∫ßn\")\n","# plt.show()\n"]},{"cell_type":"code","execution_count":17,"id":"0c6a5943","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:18.111887Z","iopub.status.busy":"2025-11-08T09:04:18.111668Z","iopub.status.idle":"2025-11-08T09:04:18.114609Z","shell.execute_reply":"2025-11-08T09:04:18.114063Z"},"papermill":{"duration":0.011372,"end_time":"2025-11-08T09:04:18.115701","exception":false,"start_time":"2025-11-08T09:04:18.104329","status":"completed"},"tags":[]},"outputs":[],"source":["# corr = df[cols].corr(method='pearson')\n","# plt.figure(figsize=(8,6))\n","# sns.heatmap(corr, annot=True, cmap='coolwarm', fmt=\".2f\")\n","# plt.title(\"Ma tr·∫≠n t∆∞∆°ng quan gi·ªØa c√°c h√†nh vi xem video\")\n","# plt.show()\n"]},{"cell_type":"code","execution_count":18,"id":"a19d34aa","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:18.131153Z","iopub.status.busy":"2025-11-08T09:04:18.130676Z","iopub.status.idle":"2025-11-08T09:04:19.268994Z","shell.execute_reply":"2025-11-08T09:04:19.268182Z"},"papermill":{"duration":1.147687,"end_time":"2025-11-08T09:04:19.270376","exception":false,"start_time":"2025-11-08T09:04:18.122689","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["3405404"]},"execution_count":18,"metadata":{},"output_type":"execute_result"}],"source":["from pyspark.sql import functions as F\n","\n","# Gi·∫£ ƒë·ªãnh df_user_video_final v√† df_user_course_grouped ƒë√£ ƒë∆∞·ª£c n·∫°p\n","uv = df_user_video_final.alias(\"uv\")\n","uc = df_user_course_grouped.alias(\"uc\")\n","\n","# 1) JOIN c√≥ ƒëi·ªÅu ki·ªán (KH√îNG explode video_list)\n","uv_in_course = (\n","    uv.join(\n","        uc,\n","        (F.col(\"uv.user_id\") == F.col(\"uc.user_id\")) &\n","        F.array_contains(F.col(\"uc.video_list\"), F.col(\"uv.video_id\")),\n","        \"inner\"\n","    )\n","    .select(\n","        F.col(\"uc.course_id\"),\n","        F.col(\"uc.user_id\"),\n","        F.col(\"uv.video_id\"),\n","        F.col(\"uv.rewind_time\").alias(\"rewind_time\"),\n","        F.col(\"uv.fast_forward_time\").alias(\"fast_forward_time\"),\n","        F.col(\"uv.first_local_start_time\").alias(\"first_local_start_time\"),\n","        F.col(\"uv.start_hour\").alias(\"start_hour\"),\n","        F.col(\"uv.start_dayofweek\").alias(\"start_dayofweek\"),\n","        F.col(\"uv.actual_watch_time\").alias(\"actual_watch_time\"),\n","        F.col(\"uv.weighted_watch_time\").alias(\"weighted_watch_time\"),\n","        F.col(\"uv.interaction_count\").alias(\"interaction_count\"),\n","        F.col(\"uv.session_count\").alias(\"session_count\"),\n","        F.col(\"uv.speed_change_count\").alias(\"speed_change_count\"),\n","        F.col(\"uv.average_speed\").alias(\"average_speed\"),\n","        F.col(\"uv.max_watch_point\").alias(\"max_watch_point\")\n","    )\n","    .repartition(\"user_id\")\n",")\n","\n","# 2) G·ªôp l√™n c·∫•p (course_id, user_id)\n","uv_agg = (\n","    uv_in_course\n","    .groupBy(\"course_id\", \"user_id\")\n","    .agg(\n","        F.countDistinct(\"video_id\").alias(\"num_watched_in_course\"),\n","        F.sum(\"actual_watch_time\").alias(\"sum_actual_watch_time_in_course\"),\n","        F.sum(\"weighted_watch_time\").alias(\"sum_weighted_watch_time_in_course\"),\n","        F.sum(\"interaction_count\").alias(\"sum_interactions_in_course\"),\n","        F.sum(\"session_count\").alias(\"sum_sessions_in_course\"),\n","        F.sum(\"speed_change_count\").alias(\"sum_speed_changes_in_course\"),\n","        F.avg(\"average_speed\").alias(\"avg_speed_in_course\"),\n","        F.max(\"max_watch_point\").alias(\"max_watch_point_in_course\"),\n","        F.sum(\"fast_forward_time\").alias(\"sum_fast_forward_time_in_course\"),\n","        F.sum(\"rewind_time\").alias(\"sum_rewind_time_in_course\"),\n","        F.min(\"first_local_start_time\").alias(\"first_local_start_time\"),\n","        F.avg(\"start_hour\").alias(\"avg_start_hour_in_course\"),\n","        F.avg(\"start_dayofweek\").alias(\"avg_start_dow_in_course\"),\n","    )\n",")\n","\n","# 3) LEFT JOIN v√†o UC\n","res0 = uc.join(uv_agg, on=[\"course_id\", \"user_id\"], how=\"left\")\n","\n","# 4) T·∫°o RATIOs\n","nz = lambda col: F.when(F.col(col).isNull() | (F.col(col) == 0), F.lit(None)).otherwise(F.col(col))\n","\n","result = (\n","    res0\n","    .withColumn(\"coverage_ratio\", F.col(\"num_watched_in_course\") / nz(\"num_videos\"))\n","    .withColumn(\"course_watch_ratio\", F.col(\"sum_actual_watch_time_in_course\") / nz(\"total_video_duration\"))\n","    .withColumn(\"weighted_watch_ratio\", F.col(\"sum_weighted_watch_time_in_course\") / nz(\"total_video_duration\"))\n","    .withColumn(\"interactions_per_video\", F.col(\"sum_interactions_in_course\") / nz(\"num_watched_in_course\"))\n","    .withColumn(\"sessions_per_video\", F.col(\"sum_sessions_in_course\") / nz(\"num_watched_in_course\"))\n","    .withColumn(\"speed_changes_per_session\", F.col(\"sum_speed_changes_in_course\") / nz(\"sum_sessions_in_course\"))\n","    .withColumn(\"fast_forward_per_watch\", F.col(\"sum_fast_forward_time_in_course\") / nz(\"sum_actual_watch_time_in_course\"))\n","    .withColumn(\"rewind_per_watch\", F.col(\"sum_rewind_time_in_course\") / nz(\"sum_actual_watch_time_in_course\"))\n","    .withColumn(\"max_watch_point_ratio\", F.col(\"max_watch_point_in_course\") / nz(\"total_video_duration\"))\n","    .fillna(0, subset=[\n","        \"coverage_ratio\",\"course_watch_ratio\",\"weighted_watch_ratio\",\n","        \"interactions_per_video\",\"sessions_per_video\",\"speed_changes_per_session\",\n","        \"fast_forward_per_watch\",\"rewind_per_watch\",\"max_watch_point_ratio\"\n","    ])\n","    .drop(\n","        \"sum_actual_watch_time_in_course\",\"sum_weighted_watch_time_in_course\",\n","        \"sum_interactions_in_course\",\"sum_sessions_in_course\",\n","        \"sum_speed_changes_in_course\",\"sum_fast_forward_time_in_course\",\n","        \"sum_rewind_time_in_course\",\"max_watch_point_in_course\",\n","        \"total_video_duration\",\"num_videos\",\"num_watched_in_course\", \"video_list\"\n","    )\n",")\n","\n","# 5) S·ª¨A L·ªñI: ƒê·ªïi 'enroll_time' th√†nh 'enroll_date'\n","result = (\n","    result\n","    .withColumn(\n","        \"since_day_enroll\",\n","        # S·ª¨A ·ªû ƒê√ÇY: D√πng 'enroll_date'\n","        F.abs(F.day(F.col(\"first_local_start_time\")) - F.day(F.col(\"enroll_date\")))\n","    )\n","    .withColumn(\n","        \"since_enroll_per_remain_ratio\",\n","        F.col(\"since_day_enroll\") / nz(\"remain_day\") \n","    )\n","    .drop(\n","        \"first_local_start_time\", \n","        \"enroll_date\", # S·ª¨A ·ªû ƒê√ÇY: D√πng 'enroll_date'\n","        \"start_date\",\n","        \"end_date\"\n","    )\n","    .fillna({\n","        \"since_day_enroll\": 0,\n","        \"since_enroll_per_remain_ratio\": 0\n","    })\n",")\n","\n","# (T√πy ch·ªçn) Hi·ªÉn th·ªã k·∫øt qu·∫£ ƒë·ªÉ ki·ªÉm tra\n","result.count()"]},{"cell_type":"code","execution_count":19,"id":"5e6cae34","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:19.286723Z","iopub.status.busy":"2025-11-08T09:04:19.286434Z","iopub.status.idle":"2025-11-08T09:04:19.398373Z","shell.execute_reply":"2025-11-08T09:04:19.397304Z"},"papermill":{"duration":0.122812,"end_time":"2025-11-08T09:04:19.400799","exception":false,"start_time":"2025-11-08T09:04:19.277987","status":"completed"},"tags":[]},"outputs":[],"source":["from pyspark.sql import functions as F\n","from pyspark.sql.types import DoubleType, FloatType, DecimalType, DateType, TimestampType, IntegerType, LongType\n","\n","# 1) L√†m tr√≤n round(2) cho to√†n b·ªô c·ªôt s·ªë th·ª±c (double/float/decimal)\n","EXCLUDE_COLS = {\n","    \"user_id\", \"course_id\",  # kh√≥a\n","    \"since_day_enroll\",      # s·ªë nguy√™n (ƒë·ªÉ nguy√™n)\n","    # n·∫øu c√≤n c√°c c·ªôt ng√†y/ts t·ª´ uc nh∆∞ start_date/end_date/certificate... th√¨ c≈©ng kh√¥ng round\n","}\n","\n","exprs = []\n","for field in result.schema.fields:\n","    name = field.name\n","    dt = field.dataType\n","    if name in EXCLUDE_COLS or isinstance(dt, (DateType, TimestampType, IntegerType, LongType)):\n","        exprs.append(F.col(name))\n","    elif isinstance(dt, (DoubleType, FloatType, DecimalType)):\n","        exprs.append(F.round(F.col(name), 2).alias(name))\n","    else:\n","        exprs.append(F.col(name))\n","\n","result = result.select(*exprs)\n","\n","# 2) (tu·ª≥ ch·ªçn) ƒë·∫£m b·∫£o c√°c ratio kh√¥ng null -> 0\n","ratio_cols = [\n","    \"coverage_ratio\",\"course_watch_ratio\",\"weighted_watch_ratio\",\n","    \"interactions_per_video\",\"sessions_per_video\",\"speed_changes_per_session\",\n","    \"fast_forward_per_watch\",\"rewind_per_watch\",\"max_watch_point_ratio\"\n","]\n","result = result.fillna(0, subset=ratio_cols)\n"]},{"cell_type":"code","execution_count":20,"id":"eeb39241","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:04:19.417659Z","iopub.status.busy":"2025-11-08T09:04:19.417333Z","iopub.status.idle":"2025-11-08T09:05:09.439346Z","shell.execute_reply":"2025-11-08T09:05:09.438583Z"},"papermill":{"duration":50.033213,"end_time":"2025-11-08T09:05:09.442123","exception":false,"start_time":"2025-11-08T09:04:19.40891","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["[Stage 24:==============>                                           (1 + 3) / 4]\r"]},{"name":"stdout","output_type":"stream","text":["+---------+----------+----------+-------------------+------------------------+-----------------------+--------------+------------------+--------------------+----------------------+------------------+-------------------------+----------------------+----------------+---------------------+----------------+-----------------------------+\n","|course_id|user_id   |remain_day|avg_speed_in_course|avg_start_hour_in_course|avg_start_dow_in_course|coverage_ratio|course_watch_ratio|weighted_watch_ratio|interactions_per_video|sessions_per_video|speed_changes_per_session|fast_forward_per_watch|rewind_per_watch|max_watch_point_ratio|since_day_enroll|since_enroll_per_remain_ratio|\n","+---------+----------+----------+-------------------+------------------------+-----------------------+--------------+------------------+--------------------+----------------------+------------------+-------------------------+----------------------+----------------+---------------------+----------------+-----------------------------+\n","|C_676635 |U_24687675|71        |1.03               |3.51                    |1.97                   |0.67          |0.0               |0.0                 |1.34                  |1.0               |0.11                     |0.11                  |0.0             |0.0                  |3               |0.04                         |\n","|C_735175 |U_1310091 |143       |2.0                |15.44                   |3.0                    |0.62          |0.12              |0.06                |3.59                  |1.0               |0.0                      |2.78                  |2.8             |0.04                 |12              |0.08                         |\n","|C_1903985|U_29074269|100       |1.0                |6.68                    |2.44                   |0.62          |0.0               |0.0                 |3.46                  |1.0               |0.0                      |0.11                  |0.05            |0.0                  |1               |0.01                         |\n","|C_1903985|U_15278395|90        |1.49               |7.9                     |3.0                    |0.61          |0.0               |0.0                 |9.48                  |1.0               |0.0                      |0.87                  |0.02            |0.0                  |0               |0.0                          |\n","|C_697076 |U_16056340|144       |1.0                |9.94                    |2.33                   |0.57          |0.51              |0.51                |4.0                   |1.0               |0.0                      |0.11                  |0.22            |0.03                 |0               |0.0                          |\n","|C_1903985|U_99772   |121       |1.0                |8.17                    |3.46                   |0.53          |0.0               |0.0                 |3.46                  |1.0               |0.0                      |0.28                  |0.44            |0.0                  |16              |0.13                         |\n","|C_676676 |U_8164830 |98        |2.0                |7.17                    |2.25                   |0.46          |0.0               |0.0                 |7.75                  |1.0               |0.0                      |0.15                  |0.0             |0.0                  |0               |0.0                          |\n","|C_1903985|U_31742340|91        |1.0                |8.3                     |3.5                    |0.45          |0.0               |0.0                 |8.53                  |1.0               |0.0                      |0.23                  |0.36            |0.0                  |30              |0.33                         |\n","|C_1903985|U_14796487|104       |2.0                |15.9                    |2.27                   |0.45          |0.0               |0.0                 |7.97                  |1.0               |0.0                      |0.73                  |0.04            |0.0                  |1               |0.01                         |\n","|C_1428968|U_32136014|92        |1.32               |13.45                   |4.09                   |0.45          |0.0               |0.0                 |8.68                  |1.0               |0.14                     |0.15                  |0.24            |0.0                  |0               |0.0                          |\n","|C_697076 |U_31521727|140       |1.0                |7.07                    |3.04                   |0.43          |0.43              |0.43                |15.22                 |1.0               |0.0                      |0.3                   |0.56            |0.03                 |3               |0.02                         |\n","|C_756642 |U_13652440|94        |1.0                |4.14                    |5.23                   |0.42          |0.23              |0.23                |6.14                  |1.0               |0.0                      |0.15                  |0.22            |0.03                 |9               |0.1                          |\n","|C_1903985|U_30654427|105       |1.0                |18.86                   |2.5                    |0.42          |0.0               |0.0                 |8.61                  |1.0               |0.0                      |0.66                  |0.03            |0.0                  |0               |0.0                          |\n","|C_1428968|U_3424470 |89        |1.0                |12.6                    |5.5                    |0.41          |0.0               |0.0                 |5.85                  |1.0               |0.0                      |0.06                  |0.06            |0.0                  |0               |0.0                          |\n","|C_1903985|U_30888854|104       |1.59               |9.63                    |3.07                   |0.41          |0.0               |0.0                 |5.81                  |1.0               |0.04                     |0.1                   |0.0             |0.0                  |0               |0.0                          |\n","|C_1903985|U_31204045|107       |1.93               |9.48                    |3.67                   |0.41          |0.0               |0.0                 |9.19                  |1.0               |0.0                      |0.18                  |0.08            |0.0                  |3               |0.03                         |\n","|C_1903985|U_31084435|116       |1.73               |2.69                    |3.12                   |0.39          |0.0               |0.0                 |3.19                  |1.0               |0.15                     |0.13                  |0.09            |0.0                  |12              |0.1                          |\n","|C_1903985|U_13837757|72        |1.23               |6.04                    |2.71                   |0.36          |0.0               |0.0                 |2.67                  |1.0               |0.46                     |0.11                  |0.0             |0.0                  |2               |0.03                         |\n","|C_1903985|U_16544503|104       |1.23               |5.0                     |3.61                   |0.35          |0.0               |0.0                 |11.61                 |1.0               |0.13                     |0.26                  |0.36            |0.0                  |0               |0.0                          |\n","|C_1903985|U_29387832|104       |1.29               |13.22                   |2.04                   |0.35          |0.0               |0.0                 |13.13                 |1.0               |0.09                     |0.47                  |0.01            |0.0                  |1               |0.01                         |\n","|C_676635 |U_17698865|71        |1.67               |14.44                   |2.0                    |0.35          |0.0               |0.0                 |2.94                  |1.0               |0.33                     |0.41                  |0.14            |0.0                  |4               |0.06                         |\n","|C_746997 |U_31121290|132       |1.51               |1.97                    |2.43                   |0.34          |0.25              |0.17                |6.76                  |1.0               |0.0                      |0.17                  |0.0             |0.02                 |2               |0.02                         |\n","|C_782555 |U_30083730|132       |1.0                |6.69                    |3.27                   |0.33          |0.21              |0.21                |4.58                  |1.0               |0.0                      |0.43                  |0.04            |0.03                 |4               |0.03                         |\n","|C_1428968|U_31068137|92        |1.0                |18.0                    |3.25                   |0.33          |0.0               |0.0                 |1.88                  |1.0               |0.0                      |3.08                  |1.83            |0.0                  |1               |0.01                         |\n","|C_947250 |U_29822103|80        |1.22               |8.33                    |3.08                   |0.33          |0.06              |0.05                |4.5                   |1.0               |0.33                     |1.87                  |0.31            |0.03                 |17              |0.21                         |\n","|C_1903985|U_17002991|95        |1.0                |6.29                    |5.95                   |0.32          |0.0               |0.0                 |2.0                   |1.0               |0.0                      |0.04                  |0.0             |0.0                  |3               |0.03                         |\n","|C_1903985|U_18523544|121       |1.0                |11.62                   |2.29                   |0.32          |0.0               |0.0                 |8.95                  |1.0               |0.0                      |0.34                  |0.49            |0.0                  |22              |0.18                         |\n","|C_947250 |U_313050  |76        |1.5                |4.82                    |6.45                   |0.31          |0.14              |0.09                |3.0                   |1.0               |0.0                      |0.05                  |0.02            |0.03                 |19              |0.25                         |\n","|C_1797904|U_414098  |63        |1.0                |7.09                    |3.27                   |0.31          |0.0               |0.0                 |2.91                  |1.0               |0.0                      |0.26                  |0.03            |0.0                  |11              |0.17                         |\n","|C_1797904|U_9863516 |75        |1.0                |4.91                    |1.73                   |0.31          |0.0               |0.0                 |2.0                   |1.0               |0.0                      |0.19                  |0.0             |0.0                  |1               |0.01                         |\n","|C_1903985|U_15084960|62        |1.95               |11.55                   |3.25                   |0.3           |0.0               |0.0                 |4.0                   |1.0               |0.0                      |0.24                  |0.0             |0.0                  |0               |0.0                          |\n","|C_1903985|U_1466633 |104       |1.1                |15.7                    |3.5                    |0.3           |0.0               |0.0                 |7.25                  |1.0               |0.05                     |0.08                  |0.0             |0.0                  |0               |0.0                          |\n","|C_1903985|U_16112013|102       |1.72               |3.55                    |2.5                    |0.3           |0.0               |0.0                 |2.45                  |1.0               |0.25                     |0.11                  |0.05            |0.0                  |4               |0.04                         |\n","|C_1903985|U_28627313|103       |1.0                |7.9                     |2.3                    |0.3           |0.0               |0.0                 |3.2                   |1.0               |0.0                      |0.19                  |0.0             |0.0                  |0               |0.0                          |\n","|C_1903985|U_31258146|103       |1.27               |11.5                    |2.65                   |0.3           |0.0               |0.0                 |11.0                  |1.0               |0.2                      |0.36                  |0.19            |0.0                  |0               |0.0                          |\n","|C_1903985|U_1860714 |61        |1.0                |9.79                    |4.37                   |0.29          |0.0               |0.0                 |8.37                  |1.0               |0.0                      |0.11                  |0.1             |0.0                  |0               |0.0                          |\n","|C_947252 |U_25370124|140       |1.5                |9.13                    |5.0                    |0.29          |0.0               |0.0                 |2.63                  |1.0               |0.0                      |0.07                  |0.06            |0.0                  |10              |0.07                         |\n","|C_735175 |U_10517395|139       |1.23               |10.53                   |3.47                   |0.29          |0.19              |0.16                |2.63                  |1.0               |0.37                     |0.22                  |0.04            |0.04                 |9               |0.06                         |\n","|C_1903985|U_14821489|115       |1.0                |13.95                   |2.26                   |0.29          |0.0               |0.0                 |7.21                  |1.0               |0.0                      |0.22                  |0.52            |0.0                  |10              |0.09                         |\n","|C_1428968|U_15303765|80        |1.79               |8.36                    |3.29                   |0.29          |0.0               |0.0                 |2.43                  |1.0               |0.29                     |0.04                  |0.19            |0.0                  |1               |0.01                         |\n","|C_1903985|U_29152044|107       |1.0                |16.79                   |2.05                   |0.29          |0.0               |0.0                 |17.37                 |1.0               |0.0                      |0.2                   |0.51            |0.0                  |2               |0.02                         |\n","|C_1903985|U_19653284|98        |1.0                |12.05                   |2.74                   |0.29          |0.0               |0.0                 |4.84                  |1.0               |0.11                     |0.11                  |0.18            |0.0                  |1               |0.01                         |\n","|C_801420 |U_12943251|92        |1.47               |4.5                     |2.71                   |0.28          |0.23              |0.16                |2.13                  |1.0               |0.08                     |0.15                  |0.0             |0.02                 |12              |0.13                         |\n","|C_854843 |U_5836530 |106       |1.01               |11.0                    |2.0                    |0.27          |0.16              |0.16                |2.86                  |1.0               |0.05                     |0.17                  |0.04            |0.03                 |7               |0.07                         |\n","|C_676635 |U_16295168|104       |1.0                |12.5                    |2.43                   |0.27          |0.0               |0.0                 |3.21                  |1.0               |0.0                      |0.07                  |0.25            |0.0                  |8               |0.08                         |\n","|C_1903985|U_31134147|118       |1.0                |6.28                    |4.22                   |0.27          |0.0               |0.0                 |13.83                 |1.0               |0.0                      |0.18                  |0.1             |0.0                  |20              |0.17                         |\n","|C_1428968|U_16071920|90        |1.0                |21.38                   |6.0                    |0.27          |0.0               |0.0                 |3.23                  |1.0               |0.0                      |0.06                  |0.0             |0.0                  |0               |0.0                          |\n","|C_1903985|U_29208898|105       |1.96               |10.83                   |3.67                   |0.27          |0.0               |0.0                 |3.28                  |1.0               |0.22                     |0.13                  |0.07            |0.0                  |1               |0.01                         |\n","|C_746997 |U_4008227 |130       |1.0                |6.21                    |3.31                   |0.26          |0.26              |0.26                |1.62                  |1.0               |0.0                      |0.06                  |0.08            |0.02                 |1               |0.01                         |\n","|C_1903985|U_16043026|110       |1.0                |16.18                   |2.59                   |0.26          |0.0               |0.0                 |4.41                  |1.0               |0.0                      |0.11                  |0.15            |0.0                  |5               |0.05                         |\n","+---------+----------+----------+-------------------+------------------------+-----------------------+--------------+------------------+--------------------+----------------------+------------------+-------------------------+----------------------+----------------+---------------------+----------------+-----------------------------+\n","only showing top 50 rows\n","\n"]},{"name":"stderr","output_type":"stream","text":["                                                                                \r"]}],"source":["from pyspark.sql.functions import col\n","\n","# # 1) Ch·ªâ s·∫Øp x·∫øp gi·∫£m d·∫ßn theo coverage_ratio\n","# result.orderBy(col(\"coverage_ratio\").desc()).show(50, truncate=False)\n","\n","# # 2) V·ª´a l·ªçc (v√≠ d·ª• < 1) v·ª´a s·∫Øp x·∫øp gi·∫£m d·∫ßn\n","# result.filter(col(\"coverage_ratio\") < 1) \\\n","#       .orderBy(col(\"coverage_ratio\").desc()) \\\n","#       .show(50, truncate=False)\n","\n","# 3) N·∫øu mu·ªën ƒë·∫©y null xu·ªëng cu·ªëi khi sort\n","result.orderBy(col(\"coverage_ratio\").desc_nulls_last()).show(50, truncate=False)\n"]},{"cell_type":"code","execution_count":21,"id":"b31d1c86","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:09.475073Z","iopub.status.busy":"2025-11-08T09:05:09.474722Z","iopub.status.idle":"2025-11-08T09:05:09.632613Z","shell.execute_reply":"2025-11-08T09:05:09.631902Z"},"papermill":{"duration":0.17577,"end_time":"2025-11-08T09:05:09.634025","exception":false,"start_time":"2025-11-08T09:05:09.458255","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["3405404"]},"execution_count":21,"metadata":{},"output_type":"execute_result"}],"source":["result.count()"]},{"cell_type":"code","execution_count":22,"id":"b9acf5ef","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:09.652767Z","iopub.status.busy":"2025-11-08T09:05:09.652184Z","iopub.status.idle":"2025-11-08T09:05:56.613823Z","shell.execute_reply":"2025-11-08T09:05:56.611621Z"},"papermill":{"duration":46.972904,"end_time":"2025-11-08T09:05:56.615778","exception":false,"start_time":"2025-11-08T09:05:09.642874","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["[Stage 39:>                                                         (0 + 4) / 4]\r"]},{"name":"stdout","output_type":"stream","text":["Saved Successfully\n"]},{"name":"stderr","output_type":"stream","text":["                                                                                \r"]}],"source":["result_output = 'result.parquet'\n","result.coalesce(10).write.mode(\"overwrite\").option(\"header\", \"true\").parquet(result_output)\n","print(\"Saved Successfully\")"]},{"cell_type":"code","execution_count":23,"id":"1ca03023","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.64524Z","iopub.status.busy":"2025-11-08T09:05:56.644576Z","iopub.status.idle":"2025-11-08T09:05:56.648362Z","shell.execute_reply":"2025-11-08T09:05:56.647654Z"},"papermill":{"duration":0.015753,"end_time":"2025-11-08T09:05:56.649887","exception":false,"start_time":"2025-11-08T09:05:56.634134","status":"completed"},"tags":[]},"outputs":[],"source":["# df_final = (\n","#     df_with_stats_fixed\n","#     .join(df_user_video_final, on=[\"user_id\", \"video_id\"], how=\"left\")\n","# )\n"]},{"cell_type":"code","execution_count":24,"id":"334be0cf","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.675754Z","iopub.status.busy":"2025-11-08T09:05:56.675534Z","iopub.status.idle":"2025-11-08T09:05:56.678827Z","shell.execute_reply":"2025-11-08T09:05:56.678313Z"},"papermill":{"duration":0.014483,"end_time":"2025-11-08T09:05:56.67991","exception":false,"start_time":"2025-11-08T09:05:56.665427","status":"completed"},"tags":[]},"outputs":[],"source":["# # --- 3. (Khuy·∫øn ngh·ªã) X·ª≠ l√Ω c√°c gi√° tr·ªã NULL nh∆∞ ·ªü ph·∫ßn tr∆∞·ªõc ---\n","# # C√°c video ƒë∆∞·ª£c ƒëƒÉng k√Ω nh∆∞ng \"ch∆∞a xem\" s·∫Ω c√≥ gi√° tr·ªã NULL\n","# # Ta ƒëi·ªÅn 0 v√†o c√°c c·ªôt h√†nh vi\n","# behavior_cols = [\n","#     'max_watch_point', 'rewind_time', 'fast_forward_time', 'actual_watch_time',\n","#     'weighted_watch_time', 'interaction_count', 'session_count', 'speed_change_count',\n","#     'distinct_speeds_count', 'average_speed'\n","# ]\n","\n","# df_final = df_final.fillna(0, subset=behavior_cols)\n","\n","# # G√°n t·ªëc ƒë·ªô 1.0 cho c√°c video ch∆∞a xem\n","# df_final = df_final.withColumn(\n","#     \"average_speed\",\n","#     F.when(F.col(\"actual_watch_time\") == 0, 1.0) \n","#     .otherwise(F.col(\"average_speed\"))\n","# )\n","\n","\n","# # --- 4. Hi·ªÉn th·ªã k·∫øt qu·∫£ (B√¢y gi·ªù s·∫Ω ch·∫°y ƒë∆∞·ª£c) ---\n","# print(\"ƒê√£ join th√†nh c√¥ng, ƒëang hi·ªÉn th·ªã k·∫øt qu·∫£:\")\n","# # df_final.count()"]},{"cell_type":"code","execution_count":25,"id":"4c00a0d5","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.699421Z","iopub.status.busy":"2025-11-08T09:05:56.698735Z","iopub.status.idle":"2025-11-08T09:05:56.702349Z","shell.execute_reply":"2025-11-08T09:05:56.701673Z"},"papermill":{"duration":0.014365,"end_time":"2025-11-08T09:05:56.703427","exception":false,"start_time":"2025-11-08T09:05:56.689062","status":"completed"},"tags":[]},"outputs":[],"source":["# from pyspark.sql import functions as F\n","# from pyspark.sql.functions import col, datediff, to_date\n","# df_with_day = df_final.withColumn(\n","#     \"day_from_enroll\",\n","#     datediff(to_date(col('first_local_start_time')), col('enroll_time')),\n","# )\n","\n","# df_with_abs = df_with_day.withColumn(\n","#     \"day_from_enroll\",\n","#     F.abs(F.col('day_from_enroll'))\n","# )\n","\n","# df_final = df_with_abs.drop(\"first_local_start_time\", \"enroll_time\", \"start_date\", \"end_date\", \"distinct_speeds_count\")"]},{"cell_type":"code","execution_count":26,"id":"cffc0c09","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.72268Z","iopub.status.busy":"2025-11-08T09:05:56.72197Z","iopub.status.idle":"2025-11-08T09:05:56.725485Z","shell.execute_reply":"2025-11-08T09:05:56.724715Z"},"papermill":{"duration":0.014232,"end_time":"2025-11-08T09:05:56.726652","exception":false,"start_time":"2025-11-08T09:05:56.71242","status":"completed"},"tags":[]},"outputs":[],"source":["# df_final.printSchema()"]},{"cell_type":"code","execution_count":27,"id":"2c565270","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.745781Z","iopub.status.busy":"2025-11-08T09:05:56.74516Z","iopub.status.idle":"2025-11-08T09:05:56.748648Z","shell.execute_reply":"2025-11-08T09:05:56.748045Z"},"papermill":{"duration":0.014032,"end_time":"2025-11-08T09:05:56.749654","exception":false,"start_time":"2025-11-08T09:05:56.735622","status":"completed"},"tags":[]},"outputs":[],"source":["# # S·ª≠a l·ªói ch√≠nh t·∫£ ·ªü ƒë√¢y: \"vides_watched_in_course\" -> \"videos_watched_in_course\"\n","# df_grouped = df_final.groupBy(\"user_id\", \"course_id\").agg(\n","#     # ƒê·∫øm s·ªë l∆∞·ª£ng video m√† ng∆∞·ªùi h·ªçc xem ƒë∆∞·ª£c\n","#     F.countDistinct(\"video_id\").alias(\"videos_watched_in_course\"), # <--- ƒê√É S·ª¨A\n","#     # T√≠nh t·ªïng th·ªùi l∆∞·ª£ng th·ª±c t·∫ø c·ªßa ng∆∞·ªùi d√πng trong kh√≥a h·ªçc\n","#     F.sum('actual_watch_time').alias(\"total_watch_time_in_course\"),\n","#     # L·∫•y c√°c gi√° tr·ªã t·ªïng c·ªßa kh√≥a h·ªçc \n","#     F.first('course_total_videos').alias('course_total_videos'),\n","#     F.first('course_total_duration_secs').alias('course_total_duration_secs')\n","# )\n","# # df_grouped.count()\n"]},{"cell_type":"code","execution_count":28,"id":"5f1d95fb","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.768706Z","iopub.status.busy":"2025-11-08T09:05:56.768247Z","iopub.status.idle":"2025-11-08T09:05:56.771542Z","shell.execute_reply":"2025-11-08T09:05:56.770898Z"},"papermill":{"duration":0.014031,"end_time":"2025-11-08T09:05:56.772642","exception":false,"start_time":"2025-11-08T09:05:56.758611","status":"completed"},"tags":[]},"outputs":[],"source":["# df_grouped.printSchema()"]},{"cell_type":"code","execution_count":29,"id":"b47e0e61","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.791272Z","iopub.status.busy":"2025-11-08T09:05:56.791023Z","iopub.status.idle":"2025-11-08T09:05:56.794607Z","shell.execute_reply":"2025-11-08T09:05:56.793867Z"},"papermill":{"duration":0.014126,"end_time":"2025-11-08T09:05:56.795757","exception":false,"start_time":"2025-11-08T09:05:56.781631","status":"completed"},"tags":[]},"outputs":[],"source":["# # ƒêo·∫°n code n√†y b√¢y gi·ªù s·∫Ω ch·∫°y ƒë√∫ng v√¨ t√™n c·ªôt ƒë√£ kh·ªõp\n","# df_user_completion = df_grouped.withColumn(\n","#     # T·ª∑ l·ªá ho√†n th√†nh d·ª±a tr√™n s·ªë l∆∞·ª£ng video\n","#     \"video_completion_rate\",\n","#     F.when(\n","#         F.col(\"course_total_videos\") > 0,\n","#         F.col(\"videos_watched_in_course\") / F.col(\"course_total_videos\") # <--- Gi·ªù ƒë√£ kh·ªõp\n","#     ).otherwise(0) # Tr√°nh l·ªói chia cho 0\n","# ).withColumn(\n","#     # T·ª∑ l·ªá ho√†n th√†nh d·ª±a tr√™n th·ªùi l∆∞·ª£ng xem\n","#     \"duration_completion_rate\",\n","#     F.when(\n","#         F.col(\"course_total_duration_secs\") > 0,\n","#         F.col(\"total_watch_time_in_course\") / F.col(\"course_total_duration_secs\")\n","#     ).otherwise(0) # Tr√°nh l·ªói chia cho 0\n","# )\n","\n","# # (T√πy ch·ªçn) Drop c√°c c·ªôt trung gian\n","# df_user_completion = df_user_completion.select(\n","#     \"user_id\", \"course_id\",\n","#     \"video_completion_rate\", \"duration_completion_rate\"\n","# )\n"]},{"cell_type":"code","execution_count":30,"id":"a7763c54","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.814964Z","iopub.status.busy":"2025-11-08T09:05:56.81436Z","iopub.status.idle":"2025-11-08T09:05:56.817554Z","shell.execute_reply":"2025-11-08T09:05:56.816974Z"},"papermill":{"duration":0.013754,"end_time":"2025-11-08T09:05:56.818557","exception":false,"start_time":"2025-11-08T09:05:56.804803","status":"completed"},"tags":[]},"outputs":[],"source":["# df_user_completion.count()"]},{"cell_type":"code","execution_count":31,"id":"483c98b6","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.843627Z","iopub.status.busy":"2025-11-08T09:05:56.843291Z","iopub.status.idle":"2025-11-08T09:05:56.846822Z","shell.execute_reply":"2025-11-08T09:05:56.846026Z"},"papermill":{"duration":0.016678,"end_time":"2025-11-08T09:05:56.848106","exception":false,"start_time":"2025-11-08T09:05:56.831428","status":"completed"},"tags":[]},"outputs":[],"source":["# df_user_completion.printSchema()"]},{"cell_type":"code","execution_count":32,"id":"36606b5b","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.878319Z","iopub.status.busy":"2025-11-08T09:05:56.87792Z","iopub.status.idle":"2025-11-08T09:05:56.881857Z","shell.execute_reply":"2025-11-08T09:05:56.881065Z"},"papermill":{"duration":0.017568,"end_time":"2025-11-08T09:05:56.882968","exception":false,"start_time":"2025-11-08T09:05:56.8654","status":"completed"},"tags":[]},"outputs":[],"source":["# df_final.printSchema()"]},{"cell_type":"code","execution_count":33,"id":"952b1897","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.912071Z","iopub.status.busy":"2025-11-08T09:05:56.911535Z","iopub.status.idle":"2025-11-08T09:05:56.914877Z","shell.execute_reply":"2025-11-08T09:05:56.914299Z"},"papermill":{"duration":0.018148,"end_time":"2025-11-08T09:05:56.91593","exception":false,"start_time":"2025-11-08T09:05:56.897782","status":"completed"},"tags":[]},"outputs":[],"source":["# # # df_grouped ƒë√£ ƒë∆∞·ª£c t·∫°o ·ªü √¥ [10]\n","\n","# # Th·ª±c hi·ªán join v√† GHI ƒê√à l√™n bi·∫øn df_final c≈©\n","# df_final = df_final.join(\n","#     df_user_completion, \n","#     on=[\"user_id\", \"course_id\"], \n","#     how=\"left\"\n","# )\n","\n","# df_final = df_final.drop(\n","#     \"course_total_videos\",\n","#     \"course_total_duration_secs\"\n","# )\n","\n","# # # (T√πy ch·ªçn) Ki·ªÉm tra c·∫•u tr√∫c (schema) m·ªõi c·ªßa df_final\n","# # df_final.printSchema()"]},{"cell_type":"code","execution_count":34,"id":"0bb5842c","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.935078Z","iopub.status.busy":"2025-11-08T09:05:56.934632Z","iopub.status.idle":"2025-11-08T09:05:56.938359Z","shell.execute_reply":"2025-11-08T09:05:56.937793Z"},"papermill":{"duration":0.014533,"end_time":"2025-11-08T09:05:56.939458","exception":false,"start_time":"2025-11-08T09:05:56.924925","status":"completed"},"tags":[]},"outputs":[],"source":["# # 2Ô∏è‚É£ G·ªôp theo user_id + course_id\n","# df_course_stats = df_final.groupBy(\"user_id\", \"course_id\").agg(\n","#     # ======= Th·ªëng k√™ ho·∫°t ƒë·ªông xem =======\n","#     F.countDistinct(\"video_id\").alias(\"videos_watched_in_course\"),\n","#     F.sum(\"actual_watch_time\").alias(\"total_watch_time_in_course\"),\n","#     F.sum(\"video_duration\").alias(\"total_video_duration_in_course\"),\n","#     F.avg(\"average_speed\").alias(\"avg_speed_in_course\"),\n","#     F.sum(\"interaction_count\").alias(\"total_interactions\"),\n","#     F.sum(\"session_count\").alias(\"total_sessions\"),\n","#     F.sum(\"speed_change_count\").alias(\"total_speed_changes\"),\n","#     F.sum(\"fast_forward_time\").alias(\"total_fast_forward_time\"),\n","#     F.sum(\"rewind_time\").alias(\"total_rewind_time\"),\n","#     F.sum(\"weighted_watch_time\").alias(\"total_weighted_watch_time\"),\n","#     F.avg(\"video_completion_rate\").alias(\"avg_video_completion_rate\"),\n","#     F.avg(\"duration_completion_rate\").alias(\"avg_duration_completion_rate\"),\n","\n","#     # ======= C√°c ch·ªâ s·ªë c·∫•p kh√≥a h·ªçc =======\n","#     F.first(\"day_from_enroll\").alias('day_from_enroll'),\n","#     F.first(\"certificate\").alias(\"certificate\"),          # c√≥ ch·ª©ng ch·ªâ hay kh√¥ng\n","#     F.first(\"duration_days\").alias(\"duration_days\"),      # th·ªùi l∆∞·ª£ng kh√≥a h·ªçc (ng√†y)\n","#     F.first(\"remain_day\").alias(\"remain_day\"),            # s·ªë ng√†y c√≤n l·∫°i (n·∫øu c√≥)\n","# )\n","\n","# # 3Ô∏è‚É£ T√≠nh t·ª∑ l·ªá ho√†n th√†nh kh√≥a h·ªçc (theo th·ªùi l∆∞·ª£ng)\n","# df_course_stats = df_course_stats.withColumn(\n","#     \"course_completion_rate\",\n","#     F.when(\n","#         F.col(\"total_video_duration_in_course\") > 0,\n","#         F.col(\"total_watch_time_in_course\") / F.col(\"total_video_duration_in_course\")\n","#     ).otherwise(0)\n","# )\n","\n","# # 4Ô∏è‚É£ (T√πy ch·ªçn) Ki·ªÉm tra schema k·∫øt qu·∫£\n","# # df_course_stats.printSchema()"]},{"cell_type":"code","execution_count":35,"id":"b1f52e22","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.958807Z","iopub.status.busy":"2025-11-08T09:05:56.958593Z","iopub.status.idle":"2025-11-08T09:05:56.961659Z","shell.execute_reply":"2025-11-08T09:05:56.961118Z"},"papermill":{"duration":0.014018,"end_time":"2025-11-08T09:05:56.96272","exception":false,"start_time":"2025-11-08T09:05:56.948702","status":"completed"},"tags":[]},"outputs":[],"source":["# df_course_stats.count()"]},{"cell_type":"code","execution_count":36,"id":"80466d93","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:56.981747Z","iopub.status.busy":"2025-11-08T09:05:56.981503Z","iopub.status.idle":"2025-11-08T09:05:56.984834Z","shell.execute_reply":"2025-11-08T09:05:56.984294Z"},"papermill":{"duration":0.014136,"end_time":"2025-11-08T09:05:56.985903","exception":false,"start_time":"2025-11-08T09:05:56.971767","status":"completed"},"tags":[]},"outputs":[],"source":["# # Sau khi kh·ªüi ƒë·ªông l·∫°i kernel v√† ch·∫°y l·∫°i c√°c cell...\n","\n","# # ƒê√¢y l√† DataFrame b·∫°n mu·ªën l∆∞u\n","# df_to_save = df_course_stats \n","\n","# # Gi·∫£m s·ªë l∆∞·ª£ng partition xu·ªëng m·ªôt con s·ªë h·ª£p l√Ω (v√≠ d·ª• 50)\n","# # ƒë·ªÉ gi·∫£m √°p l·ª±c cho stage cu·ªëi v√† gi·∫£m s·ªë l∆∞·ª£ng file\n","# df_to_save.coalesce(50).write.mode(\"overwrite\").parquet(\"/kaggle/working/df_course_stats.parquet\")"]},{"cell_type":"code","execution_count":37,"id":"fffad602","metadata":{"execution":{"iopub.execute_input":"2025-11-08T09:05:57.004627Z","iopub.status.busy":"2025-11-08T09:05:57.004393Z","iopub.status.idle":"2025-11-08T09:05:57.007663Z","shell.execute_reply":"2025-11-08T09:05:57.00694Z"},"papermill":{"duration":0.013922,"end_time":"2025-11-08T09:05:57.008814","exception":false,"start_time":"2025-11-08T09:05:56.994892","status":"completed"},"tags":[]},"outputs":[],"source":["# # rm -rf /kaggle/working/*\n","# from IPython.display import FileLink\n","# FileLink('/kaggle/working/df_final_output.parquet')"]},{"cell_type":"code","execution_count":null,"id":"eab6afba","metadata":{"papermill":{"duration":0.009031,"end_time":"2025-11-08T09:05:57.026839","exception":false,"start_time":"2025-11-08T09:05:57.017808","status":"completed"},"tags":[]},"outputs":[],"source":[]},{"cell_type":"code","execution_count":null,"id":"64edbf65","metadata":{"papermill":{"duration":0.008721,"end_time":"2025-11-08T09:05:57.044403","exception":false,"start_time":"2025-11-08T09:05:57.035682","status":"completed"},"tags":[]},"outputs":[],"source":[]}],"metadata":{"kaggle":{"accelerator":"gpu","dataSources":[{"datasetId":8588806,"sourceId":13526698,"sourceType":"datasetVersion"},{"datasetId":8681002,"sourceId":13654864,"sourceType":"datasetVersion"}],"dockerImageVersionId":31153,"isGpuEnabled":true,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.11.13"},"papermill":{"default_parameters":{},"duration":126.60337,"end_time":"2025-11-08T09:05:59.67194","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2025-11-08T09:03:53.06857","version":"2.6.0"}},"nbformat":4,"nbformat_minor":5}